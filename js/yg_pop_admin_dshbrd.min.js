window.ygPopDsh=window.ygPopDsh||{},function($,ygPopDsh){var lingrad,j,graphWdt=370,graphHght=102,padding=20,cnvsWdt=400,cnvsHght=265;ygPopDsh={canvas:{},ctx:{},colors:["#026fa7","#2889bb","#5fabd3","#9bcbe4","#cae3ef"],postViews:[],postTtl:[],maxViews:0,ajxInt:void 0,init:function(obj,cnvsId,postViews,postTtl){for(cnvsWdt=$("#yg_pop_dashboard_widget .inside").width(),graphWdt=cnvsWdt-30,$("#"+cnvsId).length?this.canvas=document.getElementById(cnvsId):(this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id",cnvsId),this.canvas.setAttribute("width",cnvsWdt),this.canvas.setAttribute("height",cnvsHght),$(obj)[0].insertBefore(this.canvas,document.getElementById("dw_frm"))),this.postViews=postViews,this.maxViews=Math.round(1.1*this.postViews[0]),this.maxViews=this.maxViews+(8-this.maxViews%8),this.postTtl=postTtl,this.ctx=this.canvas.getContext("2d"),lingrad=this.ctx.createLinearGradient(padding,0,graphWdt+padding,0),i=1;i<9;i++){var color=i%2==0?"#bbb":"#eee";lingrad.addColorStop(.125*i,color)}this.chartdraw()},chartdraw:function(){this.clear(),this.ctx.globalAlpha=.4,this.ctx.fillStyle=lingrad,this.rect(padding,padding,graphWdt,graphHght),this.ctx.globalAlpha=1,this.ctx.fillStyle="black",this.addGuides(),this.addlabels(),this.plotdata()},clear:function(){window.clearTimeout(this.ajxInt),this.ctx.clearRect(0,0,cnvsWdt,cnvsHght)},rect:function(x,y,w,h){this.ctx.beginPath(),this.ctx.rect(x,y,w,h),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()},rectAnimate:function(x,y,w,h,c,m,t){if(t>0){var _w=(11-t)/10*w;t-=1,this.ctx.fillStyle=c,this.ctx.beginPath(),this.ctx.rect(x,y,_w,h),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),setTimeout(function(){ygPopDsh.rectAnimate(x,y,w,h,c,m,t)},60)}else ygPopDsh.addviews(m,y,w)},addGuides:function(){this.ctx.strokeStyle="black",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(padding,padding),this.ctx.lineTo(padding,graphHght+padding),this.ctx.stroke(),this.ctx.moveTo(padding,graphHght+padding),this.ctx.lineTo(graphWdt+padding,graphHght+padding),this.ctx.stroke()},addlabels:function(){this.ctx.font="8pt Arial",this.ctx.fillText("Posts",2,15),j=1;for(var i in this.postViews)this.ctx.fillText(j,5,20.2*j+14),j++;for(this.ctx.fillText("Views",190,148),this.ctx.lineWidth=.5,i=1;8>i;i++){var color=i%2==0?"#fff":"#ddd";this.ctx.strokeStyle=color;var y=graphWdt/8*i+22,num=this.maxViews/8*i;num>999?num=(num/1e3).toFixed(1)+"k":num>999999&&(num=(num/1e6).toFixed(2)+"m");var numWdth=this.ctx.measureText(num).width;this.ctx.beginPath(),this.ctx.moveTo(y,20),this.ctx.lineTo(y,graphHght+18),this.ctx.stroke(),this.ctx.fillText(num,y-numWdth/2,134)}},plotdata:function(){this.ctx.font="8pt Arial",this.ctx.strokeStyle="#666",this.ctx.lineWidth=.5,j=0;for(var i in this.postViews){this.ctx.fillStyle=this.colors[j];var barLength=graphWdt/this.maxViews*this.postViews[j],barY=20*(j+1)+3,pCount=1==this.postViews[j]?this.postViews[j]+" view":this.postViews[j]+" views";this.rectAnimate(22,barY,barLength,16,this.colors[j],pCount,10),this.ctx.fillStyle=this.colors[j],this.rect(0,20*(j+1)+136,14,14),this.ctx.fillStyle="black",this.ctx.fillText(this.postTtl[j],18,20*(j+1)+147),j++}},addviews:function(pCount,barY,barLength){var pCountLngth=this.ctx.measureText(pCount).width;barLength-pCountLngth>0?(this.ctx.fillStyle="white",this.ctx.fillText(pCount,barLength-pCountLngth+20,barY+12)):(this.ctx.fillStyle="#666",this.ctx.fillText(pCount,barLength+24,barY+12))},clearspecific:function(cnvsId){var curCanvas=document.getElementById(cnvsId),curCtx=curCanvas.getContext("2d");curCtx.clearRect(0,0,cnvsWdt,cnvsHght)},ajxloader:function(cnvsId){this.clearspecific(cnvsId);var angle,i,curCanvas=document.getElementById(cnvsId),ctx=curCanvas.getContext("2d"),pi=Math.PI,xCenter=20,yCenter=20,radius=15,startSize=radius/4,num=5,posX=[],posY=[];this.ajxInt=window.setInterval(function(){for(num++,ctx.clearRect(0,0,cnvsWdt,cnvsHght),i=0;9>i;i++)ctx.beginPath(),ctx.fillStyle="rgba(100,100,100,"+.1*i+")",posX.length==i&&(angle=pi*i*.25,posX[i]=xCenter+radius*Math.cos(angle),posY[i]=yCenter+radius*Math.sin(angle)),ctx.arc(posX[(i+num)%8]+(cnvsWdt/2-10),posY[(i+num)%8]+100,startSize/9*i,0,2*pi,1),ctx.fill()},100)}},$(document).ready(function(){"undefined"!=typeof postsJsObj&&$.each(postsJsObj,function(key,value){ygPopDsh.init($("#yg_pop_dashboard_widget .inside"),"cnvs-"+key,value.count,value.ttl)}),$("#dw_getres").click(function(e){e.preventDefault();var lastCnvs=$("#yg_pop_dashboard_widget canvas").last(),lastTtlP=$("#yg_pop_dashboard_widget .cnvs_ttl").last();ygPopDsh.ajxloader(lastCnvs.attr("id")),lastCnvs.html("Loading...");var data={ptype:$("#dw_ptype").val(),pdur:$("#dw_dur").val(),_wpnonce:$(this).attr("pop_nonce"),action:"yg_dashwg_get_res"};$.ajax({url:ajaxurl,data:data,type:"POST",dataType:"json",success:function(data){ygPopDsh.init($("#yg_pop_dashboard_widget .inside"),lastCnvs.attr("id"),data.count,data.ttl);var lastTtlPCopy="Most popular posts";"undefined"!=typeof data.type&&(lastTtlPCopy+=data.type),"undefined"!=typeof data.days&&(lastTtlPCopy+=data.days),lastTtlP.html(lastTtlPCopy)}})})})}(jQuery,window.ygPopDsh);